<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>onRecord</title>
  <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
</head>
<body>
  <pre id="readout">Waiting for data...</pre>
  <button id="saveButton">Save JSON</button>

  <script>
    grist.ready();
    grist.onRecord(function(record) {
      const jsonData = JSON.stringify(record, null, 2);
      document.getElementById('readout').innerHTML = jsonData;

      // Function to save JSON as a file
      function saveJSONFile() {
        const blob = new Blob([jsonData], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'selected_record.json';
        a.click();
        URL.revokeObjectURL(url);

        // Confirmation message
        console.log('JSON data has been saved as "selected_record.json".');
      }

      // Attach event listener to the button
      document.getElementById('saveButton').addEventListener('click', saveJSONFile);
    });
  </script>
</body>
</html>
