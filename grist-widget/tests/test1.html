<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>onRecord</title>
    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <canvas id="pieChart" width="400" height="400"></canvas>
    <script>
      grist.ready();

      var myPieChart; // Store the chart instance in a variable.

      grist.onRecord(function(record) {
        var grossProfit = record.Gross_Profit || 0;
        var revenue = record.Revenue || 0;

        // Clear previous chart before creating a new one.
        if (myPieChart) {
          myPieChart.destroy();
        }

        var pieChartCanvas = document.getElementById('pieChart');
        var ctx = pieChartCanvas.getContext('2d');
        myPieChart = new Chart(ctx, {
          type: 'pie',
          data: {
            labels: ['Gross Profit', 'Revenue'],
            datasets: [{
              data: [grossProfit, revenue],
              backgroundColor: ['#36A2EB', '#FF6384'],
              hoverBackgroundColor: ['#36A2EB', '#FF6384'],
            }]
          },
          options: {
            responsive: true,
            legend: {
              position: 'bottom',
            }
          }
        });
      });
    </script>
  </body>
</html>
